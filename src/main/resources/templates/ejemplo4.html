<!DOCTYPE html>
<html>

<head>
<link rel="stylesheet" href="../static/estilo.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
<!-- Boton que redirecciona el modal del rgistro de usuario -->
<div class="container">
<button type="button" class="btn btn-dark" data-toggle="modal" data-target="#myModal" style="margin-top:50px; margin-bottom:30px">Nuevo</button>
</div>

<!-- tabla de datos -->

    <div class="container">
    <table >
        <thead  >
            <tr>
               <th>Id</th>
					<th>Nombre</th>
					<th>Cantidad</th>
					<th>Codigo</th>
					<th>Descripcion</th>
					<th>Precio</th>
            </tr>
        </thead>
        <tbody id="tdatos">

        </tbody>
    </table>
</div>






    	<!-- Modal del registro de Usurio -->
	  <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content"   >
                <div class="modal-header">
                    <h4 class="modal-title">Agregar Producto</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="container">
                    <div class="modal-body">
                        
                        <div class="form-group">
                        <label>Id</label>
                        <input type="number" class="form-control" name="id" id="id" style="border-color:black";>
                        </div>
                        
                        <div class="form-group">
                        <label for="nombre">Nombre:</label>
                        <input type="text" class="form-control" name="nombre" id="nombre" style="border-color:black";>
                        </div>
                        
                        <div class="form-group">
                        <label for="direccion">Cantidad:</label>
                        <textarea  class="form-control" name="direccion" id="direccion" style="border-color:black";></textarea>
                        </div>
                        
                        <div class="form-group">
                        <label for="telefono">Codigo:</label>
                        <input required class="form-control" name="telefono" id="telefono" style="border-color:black";>
                        </div>
                         <div class="form-group">
                        <label for="nombre">Descripcion:</label>
                        <input type="text" class="form-control" name="nombre" id="nombre" style="border-color:black";>
                        </div>
                         <div class="form-group">
                        <label for="nombre">Precio:</label>
                        <input type="text" class="form-control" name="nombre" id="nombre" style="border-color:black";>
                        </div>
                    </div>
                </div>
                <!-- modal footer -->
                <div class="modal-footer">
                    <button type="button" id="btnGuardar" class="btn btn-primary ml-2" data-dismiss="modal">Guardar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
                <!-- modal footer -->
                <div class="modal-footer">
                    <button type="button" id="btnGuardar" class="btn btn-primary ml-2" data-dismiss="modal">Guardar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!--Modal editar-->
    <div class="modal fade" id="editar" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Editar</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                 <div class="form-group">
                        <label for="id">Id</label>
                        <input readonly="readonly" type="number" name="id" id="id2" class="form-control" placeholder="digite el id" >
                      </div>
                      <!-- Nombre -->
                      <div class="form-group">
                              <label for="nombre">Nombre</label>
                             <input type="text" name="nombre" id="nombre2" class="form-control" placeholder="digite el nombre" >
                       </div>
                       <!-- Direccion -->
                       <div class="form-group">
                              <label for="direccion">Direccion</label>
                              <textarea class="form-control" id="direccion2" cols="30" rows="5"></textarea>
                        </div>
                       <!-- Telefono -->
                       <div class="form-group">
                              <label for="telefono">Telefono</label>
                             <input type="text" name="telefono" id="telefono2" class="form-control" placeholder="digite el telefono" >
                       </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnActualizar" class="btn btn-warning mr-2" data-dismiss="modal">Guardar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

     <!--Modal eliminar-->
    <div class="modal fade" id="eliminar" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Eliminar</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
               <div class="modal-body">
                 <h1>¿Esta seguro de eliminar el registro?</h1>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnEliminar" class="btn btn-success mr-2" data-dismiss="modal">SI</button>
            </div>
        </div>
    </div>


    



    <!-- script's para jquery y bootstrap -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script>
    let persona={id:0};
    function setIdPersona(id){
        persona.id=id;
       // alert("id: "+persona.id);
    }
     //preparancdo todo para cuando el documento o la apgina web se ha cargado y esta lista
     $(document).ready(inicio);
     function inicio() {
            cargarDatos();
            $("#btnGuardar").click(guardar);
            $("#btnEliminar").click(function(){
                eliminar(persona.id);
            });
            $("#btnActualizar").click(modificar);
     }
     function reset() {
         $("#id").val(null);
         $("#nombre").val(null);
         $("#direccion").val("");
         $("#direccion").text("");
         $("#telefono").val(null);
         $("#id2").val(null);
         $("#nombre2").val(null);
         $("#direccion2").val("");
         $("#direccion2").text("");
         $("#telefono2").val(null);
     }
      //METODO PARA CARGAR DATOS CON UNA PETICION AJAX
      //EN LA TABLA.
      function cargarDatos() {
          //peticion AJAX al back-end
          $.ajax({
            url:"/persona/all",
            method:"Get",
            success:function(response){
                //se procesa la respuesta del back-end o servidor
                //y se agregar los valores obtenidos en la respuesta
                //a la tabla, a su tbody
                //resetear datos de la tabla
                $("#tdatos").html("");
                //se recorren los elementos del array 
                //retornado como respuesta
                for (let i = 0; i < response.length; i++) {
                        
                    $("#tdatos").append(""
                    +"<tr>"
                        +"<td>"+response[i].id+"</td>"
                        +"<td>"+response[i].nombre+"</td>"
                        +"<td>"+response[i].direccion+"</td>"
                        +"<td>"+response[i].telefono+"</td>"
                        +"<td>"+response[i].tipoPersona.tipo+"</td>"
                        +"<td>"
                            +"<button onclick='cargarRegistro("+response[i].id+")'  type='button' class='btn btn-warning ml-4 mt-1' data-toggle='modal' data-target='#editar'>Editar</button>"
                            +"<button onclick='setIdPersona("+response[i].id+");' type='button' class='btn btn-danger ml-4 mt-1' data-toggle='modal' data-target='#eliminar'>Eliminar</button>"
                        +"</td>"
                    +"</tr>");
                        
                    }
                    
                // response.forEach(i=>{
                //      //concatenando valores a la tbody de la tabla
                   
                //     $("#tdatos").append(""
                //     +"<tr>"
                //         +"<td>"+i.id+"</td>"
                //         +"<td>"+i.nombre+"</td>"
                //         +"<td>"+i.direccion+"</td>"
                //         +"<td>"+i.telefono+"</td>"
                //         +"<td>"
                //             +"<button type='button' class='btn btn-warning ml-4 mt-1' data-toggle='modal' data-target='#editar'>Editar</button>"
                //             +"<button type='button' class='btn btn-danger ml-4 mt-1' data-toggle='modal' data-target='#eliminar'>Eliminar</button>"
                //         +"</td>"
                //     +"</tr>");
                // });
            },
            error:function(response){
                //imprimo el mensaje de error
                alert("Eror en la peticion: "+response);
            }
          });
      }
      //METODO PARA GUARDAR INFORMACION 
      function guardar(){
          $.ajax({
              url:"/persona/saveOrUpdate",
              method:"Post",
              data:{
                  id:null, //PARA GUARDAR EL id TIENE QUE IR NULO
                  nombre:$("#nombre").val(),
                  direccion:$("#direccion").val(),
                  telefono:$("#telefono").val()
               },
               success:function(response){
                    alert("REGISTRO GUARDADO CORRECTAMENTE.");
                    reset();
                    cargarDatos();
               },
               error:function(response){
                   alert("Error en la peticion "+response);
               }
          });
      }
      function eliminar(id){
          $.ajax({
              url:"/persona/delete/"+id,
              method:"Get",
              success:function(response){
                    alert("REGISTRO ELIMINADO CORRECTAMENTE.");
                    cargarDatos();
               },
               error:function(response){
                   alert("Error en la peticion "+response);
               }
          });
      }
      function cargarRegistro(id){
            $.ajax({
                url:"/persona/get/"+id,
                method:"Get",
                success:function(response){
                    $("#id2").val(response.id);
                    $("#nombre2").val(response.nombre);
                    $("#direccion2").text(response.direccion);
                    $("#direccion2").val(response.direccion);
                    $("#telefono2").val(response.telefono);
                },
                error:function(response){
                    alert("Error "+response);
                }
            });
      }
    
     function modificar(){
          $.ajax({
              url:"/persona/saveOrUpdate",
              method:"Post",
              data:{
                  id:$("#id2").val(),
                  nombre:$("#nombre2").val(),
                  direccion:$("#direccion2").val(),
                  telefono:$("#telefono2").val()
               },
               success:function(response){
                    alert("REGISTRO MODIFICADO CORRECTAMENTE.");
                    reset();
                    cargarDatos();
               },
               error:function(response){
                   alert("Error en la peticion "+response);
               }
          });
      }

    
    
    </script>
</body>

</html>